\hypertarget{3sat}{}
\section{(20) Слабоэкспоненциальные детерминированные алгоритмы SAT для 3-КНФ (Осипов Д.)}
\subsection{Начальные сведения}
\begin{problem*}[SAT]
Для данной пропозициональной формулы от $n$ переменных в конъюнктивной нормальной форме определить, выполнима ли она,
то есть существует ли присваивание переменным булевых значений, для которого она истинна.
\end{problem*}

\begin{algodescription}{Решение за $O(2^n)$}
    Переберем все $2^n$ возможных наборов значений переменных.
\end{algodescription}

\begin{nb*}
    Задача SAT NP-полна: принадлежит классу NP и, к тому же, любую задачу из NP можно свести к SAT. Научимся решать SAT за полиномиальное время $\implies$ научимся решать любую NP-задачу за полиномиальное время и получим $P=NP$. Докажем, что SAT не решается за полиномиальное время $\implies$ автоматически $P\neq NP$.
\end{nb*}

\begin{nb*} 
    SAT сводится к своему частному случаю 3-SAT, так что всё перечисленное верно и для неё.
\end{nb*}

\begin{problem*}[3-SAT]
	Пусть дана пропозициональная формула от $n$ переменных в 3-КНФ (каждый дизъюнкт содержит не более трех литералов (т.е. переменных или отрицаний переменных)). Определить, выполнима ли она.
\end{problem*}

\subsection{Метод расщепления: $O(1.92^n)$, $O(1.84^n)$}
Обозначим (как в 1 семестре): $$x^\sigma = 
\begin{cases}
x, & \sigma = 1 \\
\neg x & \sigma = 0.
\end{cases}$$
\begin{algodescription}{Решение за $O\left(\sqrt[3]{7}^n\right) = O(1.92^n)$ (метод расщепления-1)}
    Рекурсивный алгоритм. 

    Для начала упростим формулу. Если вдруг у нас в формуле есть дизъюнкт, содержащий лишь один литерал, его значение ясно, и мы его подставляем в формулу
    (это легко: надо вычеркнуть соответствующие отрицательные [получившие значение <<ложь>>] литералы из всех дизъюнктов, куда они входят, 
    и вычеркнуть дизъюнкты, содержащие положительные [получившие значение <<истина>>] литералы).
    Поступаем так, не применяя рекурсию, пока таких дизъюнктов не останется.

    Теперь выделим один из дизъюнктов $$\ldots\land(x_1^{\sigma_1} \lor x_2^{\sigma_2} \lor x_3^{\sigma_3})\land\ldots$$ Из всех восьми возможных наборов значений $x_1, x_2, x_3$ конкретно под этот дизъюнкт подходят только семь~-- все, кроме $(x_1, x_2, x_3) = (\neg\sigma_1, \neg\sigma_2, \neg\sigma_3)$.
    Для каждого из семи наборов значений делаем следующее: подставляем его в формулу и запускаем алгоритм рекурсивно на получившейся формуле от $n-3$ переменных. 
    
    \emph{Замечание.} Могут быть дизъюнкты, содержащие всего два литерала, но этот случай тривиально сводится к случаю трёх литералов.
    
    Если нарисовать дерево рекурсии, то для количества его листьев (тривиальных формул), очевидно, выполняется соотношение 
    $L(n) \le 7L(n-3)$, откуда немедленно $L(n) = O(7^{n/3})$, 
    и время работы отличается лишь полиномиальным сомножителем 
    (внутренних вершин не больше, чем листьев, действия в каждой вершине простые);
    в дальнейшем в этой главе мы будем этот сомножитель игнорировать.
\end{algodescription}

\begin{algodescription}{Решение за $\sim O(1.84^n)$ (метод расщепления-2)}
    Снова рекурсивный алгоритм. Упростив формулу, как и раньше, выделим один из дизъюнктов $$\ldots\land(x_1^{\sigma_1} \lor x_2^{\sigma_2} \lor x_3^{\sigma_3})\land\ldots$$ Рекурсивно рассмотрим три случая, когда этот дизъюнкт может быть истинен:
    \begin{enumerate}
    \item либо $x_1 = \sigma_1$,
    \item либо $x_1 = \neg\sigma_1$ и $x_2 = \sigma_2$,
    \item либо $x_1 = \neg\sigma_1$, $x_2 = \neg\sigma_2$ и $x_3 = \sigma_3$
    \end{enumerate}
    Для каждого из этих случаев сделаем подстановку и рекурсивно решим подзадачи: для формул от $n-1$, $n-2$ и $n-3$ переменных соответственно.
    
    Количество листьев в дереве рекурсии описывается соотношением $L(n) \le L(n-1) + L(n-2) + L(n-3) + O(1)$. $L(n) = O(1.84^n)$~-- его приближенное решение. 
\end{algodescription}

\subsection{$\heart~$Метод локального поиска: $O(1.74^n)$} \hypertarget{3satlocal}{}
Следующее решение основано на методе <<локального поиска>>. Зададим на множестве векторов $\{0, 1\}^n$ метрику $d(x, y) = \text{количество позиций, в которых } x \text{ и } y \text{ различны}$. Для данного вектора $x$ и натурального $r$ определим шар $H(x, r)$~-- множество векторов, отличающихся от $x$ не более, чем в $r$ позициях.

Нам понадобится следующая \hypertarget{flip20}{\textit{вспомогательная задача}}.

\begin{problem*}
    Дан вектор $x \in \{0, 1\}^n$ и натуральный радиус $r$. Проверить, есть ли в шаре $H(x, r)$ выполняющий набор для данной 3-КНФ формулы.
\end{problem*}

\begin{algodescription}{Решение вспомогательной задачи за $O(3^r)$}
    Рекурсивный алгоритм. Сначала проверим формулу на наборе $x$. Если в нем формула не выполнена, выделим в ней любой ложный дизъюнкт $(x_a^{\sigma_a} \lor x_b^{\sigma_b} \lor x_c^{\sigma_c})$. Если в $H(x, r)$ присутствует выполняющий набор $x^*$, то $x^*$ \textbf{не} совпадает с $x$ хотя бы в одной из позиций $a,b,c$. Рассмотрим три набора $x^{(a)}, x^{(b)}, x^{(c)}$, каждый из которых получается из $x$ инвертированием $a$-той, $b$-той и $c$-той переменной соответственно. Хотя бы один из наборов  $x^{(a)}, x^{(b)}, x^{(c)}$ будет на единицу ближе к $x^*$ (ведь изменилась всего одна переменная). Запустим от каждого из них этот алгоритм рекурсивно. Тогда на глубине рекурсии, не превосходящей $r$, набор $x^*$ найдется, если он есть в $H(x, r)$. Очевидно, решение работает за $O(3^r)$.
\end{algodescription}

Теперь мы готовы решать нашу задачу $3-SAT$.

\begin{algodescription}{Решение за $O\left(\sqrt{3}^n\right) = O(1.74^n)$ (локальный поиск)}
Обозначим $\mathbf 0 = (0, \ldots, 0)$ и $\mathbf 1 = (1, \ldots, 1)$~-- вектора в $\{0, 1\}^n$. Заметим, что всё пространство $\{0, 1\}^n$ покрывается двумя шарами $H(\mathbf 0, n/2)$ и $H(\mathbf 1, n/2)$. Действительно, каждый вектор длины $n$ имеет либо хотя бы $n/2$ единиц, либо хотя бы $n/2$ нулей, откуда следует требуемое. Значит, достаточно за $O(3^{n/2})$ поискать выполняющий набор в каждом из двух шаров. Итоговое время работы $O(3^{n/2}) + O(3^{n/2}) = O(3^{n/2})$.    
\end{algodescription}

